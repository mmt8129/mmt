<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MMT Pro V2</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #3b82f6; --bg: #f8fafc; --text: #1e293b; --header-bg: #ffffff; --red: #ef4444; --green: #22c55e; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; font-family: 'Inter', sans-serif; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--bg); color: var(--text); overflow: hidden; }

        .top-banner { position: fixed; top: 0; width: 100%; height: 65px; background: white; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; z-index: 1000; border-bottom: 1px solid #e2e8f0; }
        .banner-left, .banner-right { display: flex; gap: 10px; align-items: center; }
        .time-display { font-weight: 900; font-size: 18px; color: #1e293b; margin-left: 5px; }

        .btn-top { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; font-size: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-settings { background: #64748b; color: white; }
        .btn-trash { background: var(--green); color: white; }
        .btn-alert { background: var(--red); color: white; }

        #chat-screen { height: 100%; overflow-y: auto; padding: 80px 15px 120px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 14px 18px; border-radius: 18px; max-width: 85%; font-weight: 800; font-size: 15px; line-height: 1.4; word-wrap: break-word; position: relative; }
        .user-msg { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .ai-msg { align-self: flex-start; background: white; color: var(--text); border-bottom-left-radius: 4px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .fade-in { opacity: 0; animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-in { opacity: 0; transform: translateY(20px); animation: slideIn 0.5s forwards; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .input-wrapper { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; border-top: 2px solid #3b82f6; z-index: 1000; }
        .input-container { display: flex; gap: 10px; align-items: center; max-width: 900px; margin: 0 auto; }
        #user-input { flex: 1; border: 2px solid #e2e8f0; border-radius: 15px; padding: 12px; font-weight: 800; resize: none; min-height: 48px; font-size: 16px; outline: none; }
        .btn-send { width: 48px; height: 48px; background: var(--green); border: none; border-radius: 12px; color: white; font-size: 20px; display: flex; align-items: center; justify-content: center; }

        .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(6px); }
        .modal-content { background: white; width: 90%; max-width: 380px; border-radius: 24px; padding: 24px; border: 2px solid #3b82f6; overflow-y: auto; max-height: 90vh; }
        .modal-title { font-weight: 900; text-align: center; color: #3b82f6; font-size: 20px; margin-bottom: 20px; }

        .setting-row { margin-bottom: 15px; }
        .setting-label { font-weight: 900; font-size: 11px; color: #1e293b; margin-bottom: 6px; text-transform: uppercase; }
        .control-group { display: flex; align-items: center; border: 2px solid #3b82f6; border-radius: 12px; overflow: hidden; height: 45px; }
        .ctrl-btn { flex: 1; height: 100%; border: none; background: white; font-weight: 900; font-size: 20px; color: #3b82f6; cursor: pointer; }
        .ctrl-val { flex: 2; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: 900; background: #f8fafc; border-left: 2px solid #3b82f6; border-right: 2px solid #3b82f6; }

        .styled-select { width: 100%; padding: 12px; border-radius: 12px; border: 2px solid #3b82f6; font-weight: 900; font-size: 14px; outline: none; }

        .btn-main { width: 100%; padding: 16px; border-radius: 14px; border: none; font-weight: 900; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .btn-confirm { background: var(--primary); color: white; }
        .btn-danger { background: var(--red); color: white; }
        .btn-success { background: var(--green); color: white; }

        #status { position: absolute; top: -25px; left: 15px; font-size: 12px; font-weight: 900; color: var(--primary); display: none; }
        .dots::after { content: ""; animation: dots 1.5s infinite; }
        @keyframes dots { 0% { content: "."; } 33% { content: ".."; } 66% { content: "..."; } 100% { content: ""; } }
    </style>
</head>
<body>

    <div class="top-banner">
        <div class="banner-left">
            <button class="btn-top btn-settings" onclick="toggleModal('settings-modal')">‚öôÔ∏è</button>
            <div class="time-display" id="live-clock">00:00</div>
        </div>
        <div class="banner-right">
            <button class="btn-top btn-alert" onclick="showInstruction()">‚ö†Ô∏è</button>
            <button class="btn-top btn-trash" onclick="toggleModal('clear-modal')">üßπ</button>
        </div>
    </div>

    <div id="chat-screen"></div>

    <div class="input-wrapper">
        <div id="status">Baƒülanƒ±yor<span class="dots"></span></div>
        <div class="input-container">
            <button class="btn-top btn-settings" style="background:#3b82f6" onclick="document.getElementById('file-input').click()">üìé</button>
            <input type="file" id="file-input" hidden accept="image/*" onchange="previewImage(this)">
            <textarea id="user-input" rows="1" placeholder="Yaz ABƒ∞..."></textarea>
            <button class="btn-send" onclick="handleSend()">‚û§</button>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">AYARLAR</div>
            <div class="setting-row">
                <div class="setting-label">HAKKINDA (√ñZEL TALƒ∞MAT)</div>
                <textarea id="hakkinda" style="width:100%; height:80px; border:2px solid #3b82f6; border-radius:12px; padding:10px; font-weight:800; resize:none; outline:none;"></textarea>
            </div>
            <div class="setting-row"><div class="setting-label">YAZI BOYUTU</div><div class="control-group"><button class="ctrl-btn" onclick="updateVal('size', -1)">-</button><div class="ctrl-val" id="val-size">15PX</div><button class="ctrl-btn" onclick="updateVal('size', 1)">+</button></div></div>
            <div class="setting-row"><div class="setting-label">YAZI KALINLIƒûI</div><div class="control-group"><button class="ctrl-btn" onclick="updateVal('weight', -100)">-</button><div class="ctrl-val" id="val-weight">900</div><button class="ctrl-btn" onclick="updateVal('weight', 100)">+</button></div></div>
            <div class="setting-row"><div class="setting-label">DAKTƒ∞LO HIZI (MS)</div><div class="control-group"><button class="ctrl-btn" onclick="updateVal('speed', -5)">-</button><div class="ctrl-val" id="val-speed">5</div><button class="ctrl-btn" onclick="updateVal('speed', 5)">+</button></div></div>
            <div class="setting-row"><div class="setting-label">YAZI EFEKTƒ∞</div><select id="text-effect" class="styled-select"><option value="none">NORMAL</option><option value="typewriter">DAKTƒ∞LO EFEKTƒ∞</option><option value="slide">KAYARAK</option><option value="fade">SOLARAK</option></select></div>
            <button class="btn-main btn-confirm" onclick="saveSettings()">KAYDET VE KAPAT</button>
        </div>
    </div>

    <div id="clear-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">ONAY</div>
            <p style="font-weight:900; text-align:center; margin-bottom:20px;">GE√áMƒ∞≈û Sƒ∞Lƒ∞NSƒ∞N MI?</p>
            <div style="display:flex; gap:10px;"><button class="btn-main btn-danger" onclick="clearChatNow()">Sƒ∞L</button><button class="btn-main btn-success" onclick="toggleModal('clear-modal')">VAZGE√á</button></div>
        </div>
    </div>

    <div id="instruction-modal" class="modal">
        <div class="modal-content" id="instr-body">
            <div class="modal-title">TALƒ∞MAT G√ñNDER?</div>
            <p style="font-weight:800; font-size:12px; background:#f1f5f9; padding:10px; border-radius:10px;" id="instr-preview"></p>
            <button class="btn-main btn-confirm" onclick="confirmInstruction()">G√ñNDER</button>
            <button class="btn-main btn-confirm" style="background:#64748b" onclick="toggleModal('instruction-modal')">ƒ∞PTAL</button>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyC570Qhl5Dm5oNCzKFqg_WiMEuKSwqaLck';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${API_KEY}`;
        
        let chatHistory = JSON.parse(localStorage.getItem('mmt_history')) || [];
        let systemInstruction = localStorage.getItem('mmt_instruction') || "";
        let config = JSON.parse(localStorage.getItem('mmt_config')) || { size: 15, weight: 900, speed: 5, effect: 'none' };
        let selectedImage = null;

        function updateClock() { document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'}); }
        setInterval(updateClock, 1000); updateClock();

        function toggleModal(id) { const m = document.getElementById(id); m.style.display = m.style.display === 'flex' ? 'none' : 'flex'; }

        function updateVal(type, amt) {
            if(type === 'size') config.size = Math.max(10, config.size + amt);
            if(type === 'weight') config.weight = Math.max(100, Math.min(900, config.weight + amt));
            if(type === 'speed') config.speed = Math.max(1, config.speed + amt);
            applyConfigUI();
        }

        function applyConfigUI() {
            document.getElementById('val-size').innerText = config.size + "PX";
            document.getElementById('val-weight').innerText = config.weight;
            document.getElementById('val-speed').innerText = config.speed;
            document.getElementById('text-effect').value = config.effect;
        }

        function saveSettings() {
            systemInstruction = document.getElementById('hakkinda').value;
            config.effect = document.getElementById('text-effect').value;
            localStorage.setItem('mmt_instruction', systemInstruction);
            localStorage.setItem('mmt_config', JSON.stringify(config));
            toggleModal('settings-modal');
            renderChat();
        }

        function clearChatNow() {
            chatHistory = [];
            localStorage.setItem('mmt_history', "[]");
            renderChat();
            toggleModal('clear-modal');
        }

        function showInstruction() {
            document.getElementById('instr-preview').innerText = systemInstruction;
            toggleModal('instruction-modal');
        }

        async function confirmInstruction() {
            const prefix = "Bundan √∂nceki t√ºm konu≈ümalarƒ± unut. T√ºrkiye / Ankara konumunu ve yerel saati baz al. Cevaplar her zaman T√ºrk√ße olsun. Talimat: ";
            const body = document.getElementById('instr-body');
            body.innerHTML = '<div class="modal-title">Talimatlar uygulanƒ±yor<span class="dots"></span></div>';

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: prefix + systemInstruction }] }],
                        tools: [{ google_search: {} }] 
                    })
                });
                const data = await res.json();
                if(data.candidates) {
                    body.innerHTML = '<div class="modal-title" style="color:var(--green)">BAƒûLANTI TAMAM ‚úÖ</div><button class="btn-main btn-confirm" onclick="location.reload()">TAMAM</button>';
                } else { throw new Error(); }
            } catch (e) { alert("Hata!"); toggleModal('instruction-modal'); }
        }

        function renderChat() {
            const screen = document.getElementById('chat-screen');
            screen.innerHTML = '';
            chatHistory.forEach(m => {
                const d = document.createElement('div');
                d.className = `msg ${m.role === 'user' ? 'user-msg' : 'ai-msg'}`;
                d.style.fontSize = config.size + "px";
                d.style.fontWeight = config.weight;
                if(m.img) { const i = document.createElement('img'); i.src = m.img; i.style.maxWidth="100%"; i.style.borderRadius="10px"; d.appendChild(i); }
                if(m.text) { const t = document.createElement('div'); t.innerText = m.text; d.appendChild(t); }
                screen.appendChild(d);
            });
            screen.scrollTop = screen.scrollHeight;
        }

        async function handleSend() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text && !selectedImage) return;

            const img = selectedImage;
            input.value = ''; selectedImage = null;
            chatHistory.push({ role: 'user', text: text, img: img });
            renderChat();

            document.getElementById('status').style.display = 'block';

            try {
                let parts = [{ text: (systemInstruction ? "Sƒ∞STEM: " + systemInstruction + "\n\n" : "") + text }];
                if(img) parts.push({ inline_data: { mime_type: "image/jpeg", data: img.split(',')[1] } });

                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        contents: [{ parts: parts }],
                        tools: [{ google_search: {} }] 
                    })
                });

                const data = await res.json();
                if(data.candidates) {
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    const msgDiv = document.createElement('div');
                    msgDiv.className = "msg ai-msg";
                    msgDiv.style.fontSize = config.size + "px";
                    msgDiv.style.fontWeight = config.weight;
                    
                    if(config.effect === 'slide') msgDiv.classList.add('slide-in');
                    if(config.effect === 'fade') msgDiv.classList.add('fade-in');

                    document.getElementById('chat-screen').appendChild(msgDiv);

                    if(config.effect === 'typewriter') {
                        let i = 0;
                        function type() {
                            if (i < aiResponse.length) {
                                msgDiv.innerText += aiResponse.charAt(i);
                                i++;
                                setTimeout(type, config.speed);
                                document.getElementById('chat-screen').scrollTop = document.getElementById('chat-screen').scrollHeight;
                            } else { finishMsg(aiResponse); }
                        }
                        type();
                    } else {
                        msgDiv.innerText = aiResponse;
                        finishMsg(aiResponse);
                    }
                }
            } catch(e) { alert("Baƒülantƒ± kesildi!"); }
            finally { document.getElementById('status').style.display = 'none'; }
        }

        function finishMsg(txt) {
            chatHistory.push({ role: 'model', text: txt });
            localStorage.setItem('mmt_history', JSON.stringify(chatHistory));
            document.getElementById('chat-screen').scrollTop = document.getElementById('chat-screen').scrollHeight;
        }

        function previewImage(input) {
            const reader = new FileReader();
            reader.onload = (e) => { selectedImage = e.target.result; alert("Resim hazƒ±r ABƒ∞"); };
            reader.readAsDataURL(input.files[0]);
        }

        window.onload = () => {
            document.getElementById('hakkinda').value = systemInstruction;
            applyConfigUI();
            renderChat();
        };
    </script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('Servis ƒ∞≈ü√ßisi Kaydedildi! ‚úÖ'))
        .catch(err => console.log('Kayƒ±t Hatasƒ±: ‚ùå', err));
    });
  }
</script>
</body>
</html>
